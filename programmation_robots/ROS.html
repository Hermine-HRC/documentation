<!DOCTYPE html>
<html class="writer-html5" lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1.1.1. Installation &mdash; Documentation HRC Documentation 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />

  
    <link rel="shortcut icon" href="../_static/logo_48x48.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="1.2. Conventions de programmation" href="Tree-Code_conventions.html" />
    <link rel="prev" title="1.1. Programmation ROS" href="Tree-ROS.html" />

<link rel="stylesheet" href="../_static/tcs_theme.css" type="text/css" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HRC Documentation
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Tree.html">1. Programmation Robots</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="Tree-ROS.html">1.1. Programmation ROS</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1.1.1. Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fonctionnement-code">1.1.2. Fonctionnement code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#les-fichiers-erb">1.1.2.1. Les fichiers <em>.erb</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#herminebot-ou-hrc">1.1.2.2. Herminebot ou HRC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#fonctionnement-tests">1.1.3. Fonctionnement tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#executer-les-tests">1.1.3.1. Exécuter les tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#execution-sur-github">1.1.3.2. Exécution sur GitHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests-a-ajouter">1.1.3.3. Tests à ajouter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Tree-Code_conventions.html">1.2. Conventions de programmation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Code_conventions.html">1.2.1. Messages de commit et PR</a></li>
<li class="toctree-l3"><a class="reference internal" href="Code_conventions.html#langages-de-programmation">1.2.2. Langages de programmation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Code_conventions.html#commun">1.2.2.1. Commun</a></li>
<li class="toctree-l4"><a class="reference internal" href="Code_conventions.html#c">1.2.2.2. C++</a></li>
<li class="toctree-l4"><a class="reference internal" href="Code_conventions.html#python">1.2.2.3. Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Tree-Git_GitHub.html">1.3. Git et GitHub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Git_GitHub.html">1.3.1. Principe</a></li>
<li class="toctree-l3"><a class="reference internal" href="Git_GitHub.html#exemple-de-workflow">1.3.2. Exemple de workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="Git_GitHub.html#github-actions">1.3.3. GitHub Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Git_GitHub.html#commandes-git-utiles">1.3.4. Commandes Git utiles</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HRC Documentation</a>
      </nav>

      <div class="wy-nav-content">

<span style="float: right;" >
    <a class="github-button" href="https://github.com/Hermine-HRC/documentation"
       data-color-scheme="no-preference: light; light: light; dark: dark;"
       data-size="large" aria-label="Éditer cette documentation sur GitHub" >Éditer</a>
</span>


        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Tree.html"><span class="section-number">1. </span>Programmation Robots</a></li>
          <li class="breadcrumb-item"><a href="Tree-ROS.html"><span class="section-number">1.1. </span>Programmation ROS</a></li>
      <li class="breadcrumb-item active"><span class="section-number">1.1.1. </span>Installation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="installation">
<h1><span class="section-number">1.1.1. </span>Installation<a class="headerlink" href="#installation" title="Lien permanent vers cette rubrique"></a></h1>
<p>La version de ROS utilisée est ROS2 Jazzy prévu pour un fonctionnement sur Ubuntu 24.04.</p>
<p>Un guide pour l’installation est disponible dans la documentation officielle de
<a class="reference external" href="https://docs.ros.org/en/jazzy/Installation/Ubuntu-Install-Debs.html">ROS2 Jazzy</a>.</p>
<p>Une fois ROS installé, le dépôt GitHub doit être cloné si cela n’est pas déjà fait.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Hermine-HRC/cdfr.git
</pre></div>
</div>
<p>Ensuite, se rendre dans le dossier <code class="code docutils literal notranslate"><span class="pre">robot/ros_ws/</span></code>. Le fichier <code class="code docutils literal notranslate"><span class="pre">README.md</span></code> contient les instructions
pour installer les dépendances.</p>
<p>Le fichier contient les packages ROS à installer, la version de Gazebo à utiliser pour les simulations ainsi que
divers utilitaires nécessaires au développement.</p>
<p>La compilation du code peut être effectuée avec la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>build
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>La compilation peut prendre plusieurs minutes.</p>
</div>
<p>Pour sourcer le workspace pour utiliser les packages créés :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>install/setup.bash
</pre></div>
</div>
</div>
<div class="section" id="fonctionnement-code">
<h1><span class="section-number">1.1.2. </span>Fonctionnement code<a class="headerlink" href="#fonctionnement-code" title="Lien permanent vers cette rubrique"></a></h1>
<p>Plusieurs packages ont été créés, chacun ayant un rôle différent, afin de répondre à différents besoins.
Leur usage est détaillé respectivement dans les fichiers <code class="code docutils literal notranslate"><span class="pre">README.md</span></code> du dossier correspondant.</p>
<p>Certains packages contiennent du code C++ et Python. Le code C++ est contenu dans les dossiers
<code class="code docutils literal notranslate"><span class="pre">src/</span></code> et <code class="code docutils literal notranslate"><span class="pre">include/</span></code>. Le code Python quant à lui est contenu dans le dossier du même nom que le package.</p>
<p>Le package <code class="code docutils literal notranslate"><span class="pre">bringup</span></code> contient les fichiers de launch regroupant tous les packages.</p>
<div class="section" id="les-fichiers-erb">
<h2><span class="section-number">1.1.2.1. </span>Les fichiers <em>.erb</em><a class="headerlink" href="#les-fichiers-erb" title="Lien permanent vers cette rubrique"></a></h2>
<p>Ces fichiers sont des templates ERB. Ils sont utilisés pour générer les fichiers de données à partir de code en Ruby.
Ils permettent notamment de réaliser des boucles afin d’éviter de dupliquer des informations.
Ils sont convertis en fichiers de données à la compilation suivant les règles données dans le ficher
<code class="code docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p>
</div>
<div class="section" id="herminebot-ou-hrc">
<h2><span class="section-number">1.1.2.2. </span>Herminebot ou HRC<a class="headerlink" href="#herminebot-ou-hrc" title="Lien permanent vers cette rubrique"></a></h2>
<p>Tous les packages sont préfixés <code class="code docutils literal notranslate"><span class="pre">herminebot_</span></code> ou <code class="code docutils literal notranslate"><span class="pre">hrc_</span></code>.
Ceux qui commencent par <code class="code docutils literal notranslate"><span class="pre">hrc_</span></code> sont des packages qui ont pour vocation d’être utilisés en tant que bibliothèque
alors que ceux qui commencent par <code class="code docutils literal notranslate"><span class="pre">herminebot_</span></code> sont des packages qui ont pour vocation d’être utilisés
pour le fonctionnement de l’herminebot.</p>
</div>
</div>
<div class="section" id="fonctionnement-tests">
<h1><span class="section-number">1.1.3. </span>Fonctionnement tests<a class="headerlink" href="#fonctionnement-tests" title="Lien permanent vers cette rubrique"></a></h1>
<p>Les tests permettent de vérifier que le code est correct et qu’il respecte les conventions de programmation.
Ils sont contenus dans le dossier <code class="code docutils literal notranslate"><span class="pre">test/</span></code> de chaque package.</p>
<p>Les frameworks utilisés sont :</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">ament_cmake_pytest</span></code> pour le code Python</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">ament_cmake_gtest</span></code> pour le code C++</p></li>
</ul>
<p>Des linters sont utilisés afin de vérifier que le code respecte les conventions de programmation :</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">flake8</span></code> et <code class="code docutils literal notranslate"><span class="pre">pep257</span></code> pour le code Python</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">uncrustify</span></code> pour le code C++</p></li>
</ul>
<p>Les règles sont détaillées dans la partie <a class="reference internal" href="Tree-Code_conventions.html"><span class="doc">Conventions de programmation</span></a>.</p>
<div class="section" id="executer-les-tests">
<h2><span class="section-number">1.1.3.1. </span>Exécuter les tests<a class="headerlink" href="#executer-les-tests" title="Lien permanent vers cette rubrique"></a></h2>
<p>Pour exécuter les tests, il faut d’abord compiler le code puis exécuter les tests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>build
colcon<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>Les tests ne mettent que quelques secondes à exécuter.</p>
<p>Les détails des tests peuvent être affichés avec la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon<span class="w"> </span>test-result<span class="w"> </span>--all<span class="w"> </span>--verbose
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour toutes les erreurs de linter, il suffit de corriger de la façon qui est proposée (sauf cas exceptionnel).</p>
</div>
</div>
<div class="section" id="execution-sur-github">
<h2><span class="section-number">1.1.3.2. </span>Exécution sur GitHub<a class="headerlink" href="#execution-sur-github" title="Lien permanent vers cette rubrique"></a></h2>
<p>Les tests sont exécutés sur GitHub, afin de vérifier que le code est correct et qu’il respecte les conventions de
programmation, à chaque <em>push</em> sur la branche <code class="code docutils literal notranslate"><span class="pre">master</span></code> ou dans une <em>pull request</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Il faut plus de 10 minutes pour exécuter les tests sur GitHub car toute l’installation puis la compilation
sont réalisées.</p>
</div>
<p>Si les tests échouent, il faut vérifier en local si ça échoue aussi et la cas échéant corriger le code.
Si en local les tests passent, c’est parce que les tests échouent parfois de manière intermittente. Dans ce cas,
il faut relancer les tests.</p>
<p>Une fois que les tests sont passés, une couverture de code est générée. Le rapport est accessible sur le site
<a class="reference external" href="https://app.codecov.io/github/Hermine-HRC/cdfr">codecov</a> ou en cliquant sur le badge <code class="code docutils literal notranslate"><span class="pre">codecov</span></code>
dans le <em>README</em>.</p>
</div>
<div class="section" id="tests-a-ajouter">
<h2><span class="section-number">1.1.3.3. </span>Tests à ajouter<a class="headerlink" href="#tests-a-ajouter" title="Lien permanent vers cette rubrique"></a></h2>
<p>Autant que possible, il faut ajouter des tests afin de vérifier que le code fonctionne correctement.
Soit avec le framework <code class="code docutils literal notranslate"><span class="pre">gtest</span></code> pour les tests C++ ou avec <code class="code docutils literal notranslate"><span class="pre">pytest</span></code> pour les tests Python.</p>
<p>À ça s’ajoute aussi des tests pour vérifier que le code est conforme aux conventions de programmation.</p>
<div class="section" id="c">
<h3><span class="section-number">1.1.3.3.1. </span>C++<a class="headerlink" href="#c" title="Lien permanent vers cette rubrique"></a></h3>
<p>test_foo.cpp</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;foo.hpp&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Tester</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Tester</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="n">foo_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="p">();}</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">foo_</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">Tester</span><span class="p">,</span><span class="w"> </span><span class="n">test_foo</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">foo_</span><span class="o">-&gt;</span><span class="n">baz</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Initialize the system</span>
<span class="w">    </span><span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Actual testing</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">test_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Shutdown</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">test_result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>test_uncrustify.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ament_index_python.packages</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_package_share_directory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ament_uncrustify.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">linter</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_uncrustify</span><span class="p">():</span>
    <span class="n">cfg_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;herminebot_bringup&quot;</span><span class="p">),</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;ament_code_style.cfg&quot;</span><span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-c</span><span class="si">{</span><span class="n">cfg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Found uncrustify errors&quot;</span>
</pre></div>
</div>
<p>CMakeLists.txt</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_add_gtest</span><span class="p">(</span><span class="s">test_foo</span><span class="w"> </span><span class="s">test_foo.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">test_foo</span>
<span class="w">    </span><span class="s">foo_lib</span>
<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">python_tests</span>
<span class="w">    </span><span class="s">test_uncrustify.py</span>
<span class="p">)</span>
<span class="nb">foreach</span><span class="p">(</span><span class="s">python_test</span><span class="w"> </span><span class="o">${</span><span class="nv">python_tests</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">string</span><span class="p">(</span><span class="s">REPLACE</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="s">python_test_name</span><span class="w"> </span><span class="o">${</span><span class="nv">python_test</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ament_add_pytest_test</span><span class="p">(</span><span class="o">${</span><span class="nv">python_test_name</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">python_test</span><span class="o">}</span>
<span class="w">        </span><span class="s">APPEND_ENV</span><span class="w"> </span><span class="s">PYTHONPATH=</span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span>
<span class="w">        </span><span class="s">TIMEOUT</span><span class="w"> </span><span class="s">60</span>
<span class="w">        </span><span class="s">WORKING_DIRECTORY</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="o">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="nb">endforeach</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h3><span class="section-number">1.1.3.3.2. </span>Python<a class="headerlink" href="#python" title="Lien permanent vers cette rubrique"></a></h3>
<p>test_foo.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">foo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rclpy</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_demo</span><span class="p">():</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Foo</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">baz</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
   <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s1">&#39;-v&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>test_flake8.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ament_flake8.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">main_with_errors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">flake8</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">linter</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_flake8</span><span class="p">():</span>
    <span class="n">rc</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">main_with_errors</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--linelength=120&#39;</span><span class="p">,</span> <span class="s1">&#39;--exclude=$pkg_name$/__init__.py&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> \
        <span class="s1">&#39;Found </span><span class="si">%d</span><span class="s1"> code style errors / warnings:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">+</span> \
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
<p>test_pep257.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ament_pep257.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">linter</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">pep257</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_pep257</span><span class="p">():</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Found code style errors / warnings&#39;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Si le code se situe dans un package cmake, il faut modifier le fichier <code class="code docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> pour ajouter les tests.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">python_tests</span>
<span class="w">    </span><span class="s">test_foo.py</span>
<span class="w">    </span><span class="s">test_flake8.py</span>
<span class="w">    </span><span class="s">test_pep257.py</span>
<span class="p">)</span>
<span class="nb">foreach</span><span class="p">(</span><span class="s">python_test</span><span class="w"> </span><span class="o">${</span><span class="nv">python_tests</span><span class="o">}</span><span class="p">)</span>
<span class="w">   </span><span class="nb">ament_add_pytest_test</span><span class="p">(</span><span class="o">${</span><span class="nv">python_test</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">python_test</span><span class="o">}</span>
<span class="w">       </span><span class="s">APPEND_ENV</span><span class="w"> </span><span class="s">PYTHONPATH=</span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span>
<span class="w">       </span><span class="s">TIMEOUT</span><span class="w"> </span><span class="s">60</span>
<span class="w">       </span><span class="s">WORKING_DIRECTORY</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="o">}</span>
<span class="w">   </span><span class="p">)</span>
<span class="nb">endforeach</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="Tree-ROS.html" class="btn btn-neutral float-left" title="1.1. Programmation ROS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="Tree-Code_conventions.html" class="btn btn-neutral float-right" title="1.2. Conventions de programmation" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>


      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

<script type="text/javascript" src="../_static/tcs_theme.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>



</body>
</html>